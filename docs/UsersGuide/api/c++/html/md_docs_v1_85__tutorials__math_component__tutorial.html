<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Math Component Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">NASA-v1.6.0</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_v1_85__tutorials__math_component__tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Math Component Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following example shows the steps to implement a simple pair of components connected by a pair of ports. The first, <code>MathSender</code>, will invoke the second, <code>MathReceiver</code>, via a <code>MathOp</code> port to perform a math operation and return the result via a <code>MathResult</code> port.</p>
<p><img src="img/Comp.jpg" alt="`Component` Diagram" title="Component Pair" class="inline"/></p>
<p>All the code in this tutorial can be found in this directory. This code will work if it is copied or reimplemented within the <code><a class="el" href="namespace_ref.html">Ref</a></code> directory of F´. This tutorial will walk the user through modifying the Reference app, <a class="el" href="namespace_ref.html">Ref</a>, to implement the math components.</p>
<h1><a class="anchor" id="autotoc_md67"></a>
Prerequisites</h1>
<p>This tutorial requires the user to have some basic skills and have installed F´. The prerequisite skills to understand this tutorial are as follows:</p>
<p>1) Working knowledge of Unix; how to navigate in a shell and execute programs 2) An understanding of C++, including class declarations and inheritance 3) An understanding of how XML is structured</p>
<p>Installation can be done by following the installation guide found at: ../../INSTALL.md "INSTALL.md". This guide will walk the user through the installation process and verifying the installation. In addition, users may wish to follow the ../GettingStarted/Tutorial.md "Getting Started Tutorial" in order to get a feel for the F´ environment and tools.</p>
<h1><a class="anchor" id="autotoc_md68"></a>
1 Component Descriptions</h1>
<p>This section will cover the components that will be built in this tutorial. Each component may define the commands, events, telemetry channels, and parameters. This section will list commands, events, telemetry channels, and parameters for each component that will be created.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
1.1 MathSender</h2>
<p><code>MathSender</code> must do the following:</p>
<h3><a class="anchor" id="autotoc_md70"></a>
1.1.1 Commands</h3>
<p><code>MathSender</code> should implement a <code>MS_DO_MATH</code> command. This command will have three arguments: 1) A first value in the operation 2) A second value in the operation 3) An enumerated argument specifying the operation to perform</p>
<h3><a class="anchor" id="autotoc_md71"></a>
1.1.2 Events</h3>
<p><code>MathSender</code> should emit an event telling that a command was received to perform the operation. It should also emit an event when the result is received back from <code>MathReceiver</code>.</p>
<h3><a class="anchor" id="autotoc_md72"></a>
1.1.3 Telemetry Channels</h3>
<p>MathSender should have four channels: 1) The first value 2) The second value 3) The operation 4) The result</p>
<h3><a class="anchor" id="autotoc_md73"></a>
1.1.4 Parameters</h3>
<p>MathSender will have no parameters.</p>
<p><code>MathSender</code> should be an active (i.e. threaded) component, so it will process the commands immediately. The command will be <em>asynchronous</em>, which means the handler will be executed on the thread of the active component. It will delegate the operation to <code>MathReceiver</code>.</p>
<h2><a class="anchor" id="autotoc_md74"></a>
1.2 MathReceiver</h2>
<p><code>MathReceiver</code> will be a queued component that performs the requested operation and returns the result. <code>MathReceiver</code> will be connected to the 1Hz rate group that is part of the reference example. The simple operation in this component could have just as easily been done in a passive or active component; it is done here as a queued component to illustrate how to implement one.</p>
<h3><a class="anchor" id="autotoc_md75"></a>
1.2.1 Commands</h3>
<p><code>MathReceiver</code> should implement a MR_SET_FACTOR1 command. This command will set a factor used for any subsequent operations. The result of the commanded operation will be multipled by this factor. It should default to 0 if the command is never invoked.</p>
<p><code>MathReceiver</code> should also implement a MR_CLEAR_EVENT_THROTTLE command to clear the throttled MR_SET_FACTOR1 event (see below).</p>
<h3><a class="anchor" id="autotoc_md76"></a>
1.2.2 Events</h3>
<p><code>MathReceiver</code> should have the following events:</p>
<p>1) MR_SET_FACTOR1 command event. When the command is received, <code>MathReceiver</code> should emit an event with the updated factor. The event should be throttled (i.e. stop emitting) after three invocations. Normally, throttling is used to prevent event floods if there a endlessly repeating condition. 2) MR_UPDATED_FACTOR2 event. When the factor2 parameter (see below) is updated, <code>MathReceiver</code> should emit an event with the updated value. 3) MR_OPERATION_PERFORMED event. When the component receives a request to perform the operation, it should emit an event with the arguments and operation. 4) MR_THROTTLE_CLEARED in response to the MR_CLEAR_EVENT_THROTTLE command above.</p>
<h3><a class="anchor" id="autotoc_md77"></a>
1.2.3 Channels</h3>
<p><code>MathReceiver</code> should have the following channels:</p>
<p>1) A channel that has a serializable structure argument that contains the two terms in the operation as well as the operation and the result. This will be used to illustrate an XML defined serializable as a single telemetry channel. 2) A channel that counts the number of MR_SET_FACTOR1 commands received, so that a count can be known past the throttled event. 3) A channel for each of the factors used in the operation.</p>
<h3><a class="anchor" id="autotoc_md78"></a>
1.2.4 Parameters</h3>
<p><code>MathReceiver</code> will have one parameter, a second factor used in the operation.</p>
<h2><a class="anchor" id="autotoc_md79"></a>
1.3 Operation</h2>
<p><code>MathReceiver</code> will perform the following operation when requested by <code>MathSender</code>:</p>
<p>result = (value1 operation value2)*factor1/factor2</p>
<h1><a class="anchor" id="autotoc_md80"></a>
2 Implementation</h1>
<p>This section will cover the implementation of the components for this tutorial. The implementation of these components will have the following steps:</p>
<p>1) Define the <code>MathOpPort</code> and 'MathResultPort' ports that are used between the components. 2) Define the <code>MathSender</code> component in XML and compile it. 3) Implement the <code>MathSender</code> derived implementation class. 4) Unit test the <code>MathSender</code> implementation component. 5) Define the <code>MathReceiver</code> component in XML. 6) Implement the <code>MathReceiver</code> implementation class. 7) Unit test the <code>MathReceiver</code> implementation class. 8) Connect the classes to the <code><a class="el" href="namespace_ref.html">Ref</a></code> topology. 9) Run the ground system and exercise the commands and view the telemetry and events in the GUI.</p>
<h2><a class="anchor" id="autotoc_md81"></a>
2.1 Port definition</h2>
<p>There are two ports to define in order to perform the operation between the components. The XML for the ports will be first shown in their entirety, and then the individual parts will be described.</p>
<h3><a class="anchor" id="autotoc_md82"></a>
2.1.1 MathOpPort</h3>
<p><code>MathOpPort</code> is responsible for passing the invocation of the operation from <code>MathSender</code> to <code>MathReceiver</code>. The new XML file should be placed in a new directory <code>Ref/MathPorts</code> with the name <code>MathOpPortAi.xml</code>. The XML for the port is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">Port</span> <span class="keyword">to</span> <span class="keyword">perform</span> <span class="keyword">an</span> <span class="keyword">operation</span> <span class="keyword">on</span> <span class="keyword">two</span> <span class="keyword">numbers</span></div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;operation&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOperation&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_ADD&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_SUB&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_MULTIPLY&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_DIVIDE&quot;</span>/&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">operation</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">interface</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md83"></a>
2.1.1.1 Port Name Specification</h4>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">Port</span> <span class="keyword">to</span> <span class="keyword">perform</span> <span class="keyword">an</span> <span class="keyword">operation</span> <span class="keyword">on</span> <span class="keyword">two</span> <span class="keyword">numbers</span></div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;/<span class="keywordtype">interface</span>&gt;</div>
</div><!-- fragment --><p>The <code>interface</code> tag specifies that a port is being defined. The attributes are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The name of the component type. Becomes the C++ class name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">namespace </td><td class="markdownTableBodyNone">The namespace of the component. The C++ namespace the where the component class will appear  </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md84"></a>
2.1.1.2 Port Argument Specification</h4>
<p>The port arguments are passed from component to component when they are connected. The port argument XML is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;operation&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOperation&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_ADD&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_SUB&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_MULTIPLY&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_DIVIDE&quot;</span>/&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">operation</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">args</span>&gt;</div>
</div><!-- fragment --><p>The <code>&lt;args&gt;</code> tag begins the section of the XML defining the arguments, while the <code>&lt;arg&gt;</code> tag defines a particular argument. The port argument attributes are define as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The name of the argument. Becomes the argument name in the C++ call  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">type </td><td class="markdownTableBodyNone">The type of the arguments. Can be one of the built-in types, a user define type, or an enumeration  </td></tr>
</table>
<p>The enumerations are a special type of argument. When <code>type="ENUM"</code> is an attribute of the arguments, a further listing of the elements of the enumeration are needed. For each element of the array, a name is specified. These end up being C++ enumerated types.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOperation&quot;</span>&gt;</div>
<div class="line">     &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_ADD&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_SUB&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_MULTIPLY&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MATH_DIVIDE&quot;</span>/&gt;</div>
<div class="line"> &lt;/<span class="keywordtype">enum</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md85"></a>
2.1.1.3 Adding the port to the build</h4>
<p>The build system needs to be made aware of the port XML. To do this, the user needs to create a <code>CMakeLists.txt</code> file in the directory of the port. Create a file named <code>CMakeLists.txt</code> in the <code>MathPorts</code> directory. This file tells the build system that a new file needs to be added to the build. Here are the contents:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpPortAi.xml&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Here the source files for this module are listed. In the case of ports, only the Ai.xml file is needed. The next step is to add the <code>MathPorts</code> to the <code><a class="el" href="namespace_ref.html">Ref</a></code> project.</p>
<p>The port can be added into the <code><a class="el" href="namespace_ref.html">Ref</a></code> project by editing the <code>Ref/CMakeLists.txt</code>. This will add the port directory into the directories available to the <code><a class="el" href="namespace_ref.html">Ref</a></code> build. Find the following lines in <code>Ref/CMakeLists.txt</code> and append a record with the current directory.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div>
</div><!-- fragment --><p>The file after modification should look like the following:</p>
<div class="fragment"><div class="line">...</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div>
</div><!-- fragment --><p>Now that the ports directory is part of the build system, the port can be built. If you have not already generated a build directory for <code><a class="el" href="namespace_ref.html">Ref</a></code> as described in the "INSTALL.md" and the "Getting Started" tutorial, then run the following commands to generate a build.</p>
<div class="fragment"><div class="line"># Change to Ref directory</div>
<div class="line">cd fprime/Ref</div>
<div class="line">fprime-util generate</div>
</div><!-- fragment --><p>Now, the port code can be generated and compiled:</p>
<div class="fragment"><div class="line"># Change to the MathPorts directory from Ref</div>
<div class="line">cd MathPorts</div>
<div class="line">fprime-util build</div>
</div><!-- fragment --><p>The code generation from the XML produces two files, both of which are part of the generated build directory:</p>
<div class="fragment"><div class="line">MathOpPortAc.cpp</div>
<div class="line">MathOpPortAc.hpp </div>
</div><!-- fragment --><p>These contain the C++ classes that implement the port functionality. The build system will automatically compile them when it is aware of the port XML file.</p>
<h3><a class="anchor" id="autotoc_md86"></a>
2.1.2 MathResultPort</h3>
<p><code>MathResultPort</code> is responsible for passing the result of the operation from <code>MathReceiver</code> to <code>MathSender</code>. The new XML file should be placed in the <code>Ref/MathPorts</code> directory with the name <code>MathResultPortAi.xml</code>. The XML for the port is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathResult&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">Port</span> <span class="keyword">to</span> <span class="keyword">return</span> <span class="keyword">the</span> <span class="keyword">result</span> <span class="keyword">of</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">the</span> <span class="keyword">result</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">interface</span>&gt;</div>
</div><!-- fragment --><p>This file can be added to the <code>CMakeLists.txt</code> in the <code>Ref/MathPorts</code> directory:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpPortAi.xml&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathResultPortAi.xml&quot;</div>
<div class="line"> </div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Running <code>fprime-util build</code> as before will compile the new port XML file and generate the C++ Autogenerated files. The code generated to implement ports is complete. Developers do not need to add any implementation code of their own to port definitions.</p>
<h2><a class="anchor" id="autotoc_md87"></a>
2.2 Serializable Definition</h2>
<p>A structure needs to be defined that represents the channel value needed by <code>MathReceiver</code>. All port calls, telemetry channels, events and parameters need to be comprised of <code>Serializable</code> values, or values that can be turned into a byte stream. This is needed to pass port arguments through message queues and to pass commands and telemetry to and from the ground system. Built-in basic types like integers, floating point numbers and boolean values are supported by the framework, but there are times when a developer wishes to use a custom-defined type, perhaps to keep members of a object consistent with each other. These structures can be defined in XML and the code generator will generate the C++ classes with all the neccessary serialization functions. Developers can hand-code their own, but they are not usable for telemetry since the ground sysmtem needs an XML definition to decode them.</p>
<h3><a class="anchor" id="autotoc_md88"></a>
2.2.1 MathOp</h3>
<p>The <code>MathOp</code> serializable structure is needed by <code>MathReceiver</code> for a telemetry channel that gives the values of the operation. A new directory named <code>Ref/MathTypes</code> should be created for the structure, and the file should be named <code>MathOpSerializableAi.xml</code>. The XML is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">serializable</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">This</span> <span class="keyword">value</span> <span class="keyword">holds</span> <span class="keyword">the</span> <span class="keyword">values</span> <span class="keyword">of</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">members</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;op&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT&quot;</span>/&gt;           </div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIVIDE&quot;</span>/&gt;           </div>
<div class="line">            &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">member</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">members</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">serializable</span>&gt;</div>
</div><!-- fragment --><p>Add a <code>CMakeLists.txt</code> file for the serializable:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpSerializableAi.xml&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md89"></a>
2.2.1.1 Serializable Name Specification</h4>
<p>The opening tag of the XML specifies the type name and namespace of the structure:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">serializable</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;/<span class="keywordtype">serializable</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md90"></a>
2.2.1.2 Serializable Members</h4>
<p>The <code>members</code> tag starts the section of the XML that specifies the members of the structure:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">members</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;op&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT&quot;</span>/&gt;           </div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIVIDE&quot;</span>/&gt;           </div>
<div class="line">        &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">member</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">member</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">members</span>&gt;</div>
</div><!-- fragment --><p>As with the arguments to port definitions, built-in types can be specified as well as enumerations.</p>
<p>As before with the port definitions, the <code>Ref/MathTypes</code> directory needs to be added to <code>Ref/CMakeLists.txt</code>. <br  />
</p>
<div class="fragment"><div class="line">...</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathTypes/&quot;)</div>
</div><!-- fragment --><p>This XML defined structure compiles to a C++ class that has accessors for the members of the structure.</p>
<h2><a class="anchor" id="autotoc_md91"></a>
2.3 Component Definition</h2>
<h3><a class="anchor" id="autotoc_md92"></a>
2.3.1 MathSender Component</h3>
<p>The <code>MathSender</code> component XML definition is as follows. The XML should be placed in a file <code>Ref/MathSender/MathSenderComponentAi.xml</code></p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">component</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathSender&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;active&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathOpPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathResultPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">Component</span> <span class="keyword">sending</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ports</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathOut&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathOp&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;output&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">sending</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathIn&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathResult&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async_input&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">returning</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">result</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">ports</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">commands</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">command</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async&quot;</span> <span class="keyword">opcode</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">mnemonic</span>=<span class="stringliteral">&quot;MS_DO_MATH&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Do</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">first</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">second</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;operation&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span>&gt;</div>
<div class="line">                        &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD&quot;</span>/&gt;</div>
<div class="line">                        &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUBTRACT&quot;</span>/&gt;</div>
<div class="line">                        &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULTIPLY&quot;</span>/&gt;           </div>
<div class="line">                        &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIVIDE&quot;</span>/&gt;           </div>
<div class="line">                    &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">operation</span> <span class="keyword">to</span> <span class="keyword">perform</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">             &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">command</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">commands</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">telemetry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_VAL1&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">first</span> <span class="keyword">value</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_VAL2&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">second</span> <span class="keyword">value</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_OP&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOpTlm&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD_TLM&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB_TLM&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT_TLM&quot;</span>/&gt;           </div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIV_TLM&quot;</span>/&gt;           </div>
<div class="line">            &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">operation</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_RES&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">result</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">telemetry</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">events</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_COMMAND_RECV&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_LO&quot;</span> <span class="keyword">format_string</span>=<span class="stringliteral">&quot;Math Cmd Recvd: %f %f %d&quot;</span>  &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Math</span> <span class="keyword">command</span> <span class="keyword">received</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">val1</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">val2</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;op&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">requested</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOpEv&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD_EV&quot;</span>/&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB_EV&quot;</span>/&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT_EV&quot;</span>/&gt;           </div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIV_EV&quot;</span>/&gt;           </div>
<div class="line">                &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_RESULT&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Math result is %f&quot;</span> &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Received</span> <span class="keyword">math</span> <span class="keyword">result</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">math</span> <span class="keyword">result</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">events</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">component</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md93"></a>
2.3.1.1 Component Name Specification</h4>
<p>The component name is specified in the opening tag of the XML:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">component</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathSender&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;active&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;/<span class="keywordtype">component</span>&gt;</div>
</div><!-- fragment --><p>The attributes of the tag are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The component name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">kind </td><td class="markdownTableBodyNone">What the threading/queuing model of the component is. Can be <code>passive</code>, <code>queued</code>, or <code>active</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">namespace </td><td class="markdownTableBodyNone">The C++ namespace the component will be defined in  </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md94"></a>
2.3.1.2 Port Imports</h4>
<p>The ports needed for the component are imported using <code>import_port_type</code> tags:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathOpPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathResultPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
</div><!-- fragment --><p>The path in the port import statement is relative to the root of the repository. There are a number of ports automatically included by the code generator when commands, telemetry, events or parameters are defined. They are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Facility </th><th class="markdownTableHeadNone">Ports  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Commands </td><td class="markdownTableBodyNone"><code>Fw/Command/CmdPortAi.xml</code>,<code>Fw/Command/CmdResponsePortAi.xml</code>,<code>Fw/Command/CmdRegPortAi.xml</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Events </td><td class="markdownTableBodyNone"><code>Fw/Log/LogPortAi.xml</code>,<code>Fw/Log/LogTextPortAi.xml</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Telemetry </td><td class="markdownTableBodyNone"><code>Fw/Tlm/TlmPortAi.xml</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Parameters </td><td class="markdownTableBodyNone"><code>Fw/PrmGetPortAi.xml</code>,<code>Fw/PrmSetPortAi.xml</code>  </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md95"></a>
2.3.1.3 Port Declarations</h4>
<p>Ports and their attributes are declared once the port definitions are included.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">ports</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathOut&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathOp&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;output&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">sending</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathIn&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathResult&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async_input&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">returning</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">result</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">ports</span>&gt;</div>
</div><!-- fragment --><p>The port attributes are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The port name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">data_type </td><td class="markdownTableBodyNone">The type of the port as defined in the included port definitions, in the form <code>namepace::name</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">kind </td><td class="markdownTableBodyNone">The kind of port. Can be <code>sync_input</code>,<code>async_input</code>,<code>guarded_input</code>, or <code>output</code>  </td></tr>
</table>
<p>For <code>MathSender</code>, the request for the operation will be sent on the <code>mathOut</code> output port, and the result will be returned on the <code>mathIn</code> asynchronous port. Because the component is active and the result input port is asynchronous, the port handler will execute on the thread of <code>MathSender</code>.</p>
<h4><a class="anchor" id="autotoc_md96"></a>
2.3.1.4 Command Declarations</h4>
<p>The commands defined for the component are:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">commands</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">command</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async&quot;</span> <span class="keyword">opcode</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">mnemonic</span>=<span class="stringliteral">&quot;MS_DO_MATH&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">Do</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">first</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">second</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;operation&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOp&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD&quot;</span>/&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUBTRACT&quot;</span>/&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULTIPLY&quot;</span>/&gt;           </div>
<div class="line">                    &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIVIDE&quot;</span>/&gt;           </div>
<div class="line">                &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">operation</span> <span class="keyword">to</span> <span class="keyword">perform</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;</div>
<div class="line">         &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">command</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">commands</span>&gt;</div>
</div><!-- fragment --><p>The <code>&lt;command&gt;</code> tag starts the section containing commands for <code>MathSender</code>. For each command, the following attributes are defined:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mnemonic </td><td class="markdownTableBodyNone">A text version of the command name, used in sequences and the ground tool  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">opcode </td><td class="markdownTableBodyNone">A numeric value for the command. The value is relative to a base value set when the component is added to a topology  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">kind </td><td class="markdownTableBodyNone">The kind of command. Can be <code>sync_input</code>,<code>async_input</code>,<code>guarded_input</code>, or <code>output</code>  </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md97"></a>
2.3.1.5 Telemetry</h4>
<p>The telemetry XML is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">telemetry</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_VAL1&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">The</span> <span class="keyword">first</span> <span class="keyword">value</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_VAL2&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">The</span> <span class="keyword">second</span> <span class="keyword">value</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_OP&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOpTlm&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD_TLM&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB_TLM&quot;</span>/&gt;</div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT_TLM&quot;</span>/&gt;           </div>
<div class="line">            &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIV_TLM&quot;</span>/&gt;           </div>
<div class="line">        &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">The</span> <span class="keyword">operation</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_RES&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">The</span> <span class="keyword">result</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">telemetry</span>&gt;</div>
</div><!-- fragment --><p>The <code>&lt;telemetry&gt;</code> tag starts the section containing telemetry channels for <code>MathSender</code>. For each channel, the following attributes are defined:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The channel name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">id </td><td class="markdownTableBodyNone">A numeric value for the channel. The value is relative to a base value set when the component is added to a topology  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">data_type </td><td class="markdownTableBodyNone">The data type of the channel. Can be a built-in type, an enumeration or an externally defined serializable type  </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md98"></a>
2.3.1.6 Events</h4>
<p>The XML for the defined events is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">events</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_COMMAND_RECV&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_LO&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Math Cmd Recvd: %f %f %d&quot;</span>  &gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">Math</span> <span class="keyword">command</span> <span class="keyword">received</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val1&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">val1</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val2&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">val1</span> <span class="keyword">argument</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;op&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ENUM&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">requested</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">enum</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathOpEv&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ADD_EV&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SUB_EV&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MULT_EV&quot;</span>/&gt;           </div>
<div class="line">                &lt;<span class="keywordtype">item</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DIV_EV&quot;</span>/&gt;           </div>
<div class="line">            &lt;/<span class="keywordtype">enum</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">        &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MS_RESULT&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Math result is %f&quot;</span> &gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">Received</span> <span class="keyword">math</span> <span class="keyword">result</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">math</span> <span class="keyword">result</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">        &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">events</span>&gt;</div>
</div><!-- fragment --><p>The <code>&lt;events&gt;</code> tag starts the section containing events for <code>MathSender</code>. For each event, the following attributes are defined:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The event name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">severity </td><td class="markdownTableBodyNone">The severity of the event. Can be DIAGNOSTIC, ACTIVITY_LO, ACTIVITY_HI, WARNING_LO, WARNING_HI or FATAL.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id </td><td class="markdownTableBodyNone">A numeric value for the event. The value is relative to a base value set when the component is added to a topology  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">format_string </td><td class="markdownTableBodyNone">A C-style format string for displaying the event and the argument values.  </td></tr>
</table>
<p>The directory containing the component XML can be added to the list of modules in <code>Ref/CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">...</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathTypes/&quot;)</div>
<div class="line">add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathSender/&quot;)</div>
</div><!-- fragment --><p>Create a <code>CMakeLists.txt</code> file in <code>Ref/MathSender</code> and add <code>MathSenderComponentAi.xml</code>.</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Once it is added, add the directory to the build and build the component by typing <code>fprime-util build</code> from the <code><a class="el" href="namespace_ref.html">Ref</a></code> directory.</p>
<h3><a class="anchor" id="autotoc_md99"></a>
2.3.2 MathReceiver Component</h3>
<h4><a class="anchor" id="autotoc_md100"></a>
2.3.2.1 Component Specification</h4>
<p>The <code>MathReceiver</code> component XML is as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">component</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathReceiver&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;queued&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathOpPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathPorts</span>/<span class="keyword">MathResultPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_port_type</span>&gt;<span class="keyword">Svc</span>/<span class="keyword">Sched</span>/<span class="keyword">SchedPortAi.xml</span>&lt;/<span class="keywordtype">import_port_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import_serializable_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathTypes</span>/<span class="keyword">MathOpSerializableAi.xml</span>&lt;/<span class="keywordtype">import_serializable_type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">Component</span> <span class="keyword">sending</span> <span class="keyword">a</span> <span class="keyword">math</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ports</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathIn&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathOp&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async_input&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">receiving</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">operation</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathOut&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathResult&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;output&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Port</span> <span class="keyword">for</span> <span class="keyword">returning</span> <span class="keyword">the</span> <span class="keyword">math</span> <span class="keyword">result</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SchedIn&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Sched&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;sync_input&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">rate</span> <span class="keyword">group</span> <span class="keyword">scheduler</span> <span class="keyword">input</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">ports</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">commands</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">command</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async&quot;</span> <span class="keyword">opcode</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">mnemonic</span>=<span class="stringliteral">&quot;MR_SET_FACTOR1&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Set</span> <span class="keyword">operation</span> <span class="keyword">multiplication</span> <span class="keyword">factor1</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">first</span> <span class="keyword">factor</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">             &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">command</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">command</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;async&quot;</span> <span class="keyword">opcode</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">mnemonic</span>=<span class="stringliteral">&quot;MR_CLEAR_EVENT_THROTTLE&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">Clear</span> <span class="keyword">the</span> <span class="keyword">event</span> <span class="keyword">throttle</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">command</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">commands</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">telemetry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_OPERATION&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Ref::MathOp&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">operation</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_FACTOR1S&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;U32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">The</span> <span class="keyword">number</span> <span class="keyword">of</span> <span class="keyword">MR_SET_FACTOR1</span> <span class="keyword">commands</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_FACTOR1&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Factor</span> 1 <span class="keyword">value</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">channel</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_FACTOR2&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Factor</span> 2 <span class="keyword">value</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">channel</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">telemetry</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">events</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_SET_FACTOR1&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Factor 1: %f&quot;</span>  <span class="keyword">throttle</span> = <span class="stringliteral">&quot;3&quot;</span>   &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Operation</span> <span class="keyword">factor</span> 1</div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">factor</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_UPDATED_FACTOR2&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Factor 2 updated to: %f&quot;</span> &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Updated</span> <span class="keyword">factor</span> 2</div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">factor</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_OPERATION_PERFORMED&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Operation performed: %s&quot;</span> &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Math</span> <span class="keyword">operation</span> <span class="keyword">performed</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Ref::MathOp&quot;</span>&gt;</div>
<div class="line">                    &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">operation</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">                &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">            &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_THROTTLE_CLEARED&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Event throttle cleared&quot;</span> &gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">Event</span> <span class="keyword">throttle</span> <span class="keyword">cleared</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">event</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">events</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameters</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">parameter</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor2&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">set_opcode</span>=<span class="stringliteral">&quot;10&quot;</span> <span class="keyword">save_opcode</span>=<span class="stringliteral">&quot;11&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">            <span class="keyword">A</span> <span class="keyword">test</span> <span class="keyword">parameter</span></div>
<div class="line">            &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">parameters</span>&gt;</div>
<div class="line">    </div>
<div class="line">&lt;/<span class="keywordtype">component</span>&gt;</div>
</div><!-- fragment --><p>The <code>CMakeLists.txt</code> file for this component is as follows:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponentAi.xml&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Don't forget to <code>Ref/MathReceiver</code> to <code>Ref/CMakeLists.txt</code>.</p>
<p>Many of the elements are the same as described in <code>MathSender</code>, so this section will highlight the differences.</p>
<h4><a class="anchor" id="autotoc_md101"></a>
2.3.2.1 Queued component</h4>
<p>The <code>MathReceiver</code> component is queued, which means it can receive asynchronous port invocations as messages, but needs an external thread to dequeue them.</p>
<h4><a class="anchor" id="autotoc_md102"></a>
2.3.2.2 Importing the serializable type</h4>
<p>The telemetry channels and events use a serializable type, <code>Ref::MathOp</code> to illustrate the use of those types. The following line specifies the import for this type:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">import_serializable_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathTypes</span>/<span class="keyword">MathOpSerializableAi.xml</span>&lt;/<span class="keywordtype">import_serializable_type</span>&gt;</div>
</div><!-- fragment --><p>This type is then available for events and channels, but are not available for parameters and command arguments.</p>
<h4><a class="anchor" id="autotoc_md103"></a>
2.3.2.3 Scheduler port</h4>
<p>The queued component has a scheduler port that is <code>sync_input</code>. That means the port invocation is not put on a message queue, but calls the handler on the thread of the caller of the port:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SchedIn&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;Sched&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;sync_input&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">The</span> <span class="keyword">rate</span> <span class="keyword">group</span> <span class="keyword">scheduler</span> <span class="keyword">input</span></div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">port</span>&gt;</div>
</div><!-- fragment --><p>This synchronous call allows the caller to pull any pending messages of the message queue using the thread of the component invoking the <code>SchedIn</code> port.</p>
<h4><a class="anchor" id="autotoc_md104"></a>
2.3.2.4 Throttled Event</h4>
<p>The <code>MR_SET_FACTOR1</code> event has a new argument <code>throttle = "3"</code> that specifies how many events will be emitted before the event is throttled so no more appear.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">event</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MR_SET_FACTOR1&quot;</span> <span class="keyword">severity</span>=<span class="stringliteral">&quot;ACTIVITY_HI&quot;</span> <span class="keyword">format_string</span> = <span class="stringliteral">&quot;Factor 1: %f&quot;</span>  <span class="keyword">throttle</span> = <span class="stringliteral">&quot;3&quot;</span>   &gt;</div>
<div class="line">    &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    <span class="keyword">Operation</span> <span class="keyword">factor</span> 1</div>
<div class="line">    &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">args</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;val&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;F32&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">comment</span>&gt;<span class="keyword">The</span> <span class="keyword">factor</span> <span class="keyword">value</span>&lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">arg</span>&gt;          </div>
<div class="line">    &lt;/<span class="keywordtype">args</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">event</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md105"></a>
2.3.2.5 Parameters</h4>
<p>The <code>MathReceiver</code> component has a declaration for a parameter:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">parameters</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameter</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor2&quot;</span> <span class="keyword">data_type</span>=<span class="stringliteral">&quot;F32&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">set_opcode</span>=<span class="stringliteral">&quot;10&quot;</span> <span class="keyword">save_opcode</span>=<span class="stringliteral">&quot;11&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">comment</span>&gt;</div>
<div class="line">        <span class="keyword">A</span> <span class="keyword">test</span> <span class="keyword">parameter</span></div>
<div class="line">        &lt;/<span class="keywordtype">comment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">parameters</span>&gt;</div>
</div><!-- fragment --><p>The <code>parameter</code> attributes are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id </td><td class="markdownTableBodyNone">The unique parameter ID. Relative to base ID set for the component in the topology  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name </td><td class="markdownTableBodyNone">The parameter name  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">data_type </td><td class="markdownTableBodyNone">The data type of the parameter. Must be a built-in type  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">default </td><td class="markdownTableBodyNone">Default value assigned to the parameter if there is an error retrieving it.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">set_opcode </td><td class="markdownTableBodyNone">The opcode of the command to set the parameter. Must not overlap with any of the command opcodes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">save_opcode </td><td class="markdownTableBodyNone">The opcode of the command to save the parameter. Must not overlap with any of the command opcodes  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md106"></a>
2.4 Component Implementation</h2>
<p>The component implementation consists of writing a class that is derived from the code-generated base class and filling in member functions that implement the port calls.</p>
<h3><a class="anchor" id="autotoc_md107"></a>
2.4.1 MathSender Implementation</h3>
<h4><a class="anchor" id="autotoc_md108"></a>
2.4.1.1 Stub Generation</h4>
<p>There is a F´ utility command that will generate stubs that the developer can fill in. The command to generate the stubs is: <code>fprime-util impl</code>. This should be run in the directory for the MathSender component, and will generate two files:</p>
<div class="fragment"><div class="line">MathSenderComponentImpl.hpp-template</div>
<div class="line">MathSenderComponentImpl.cpp-template</div>
</div><!-- fragment --><p>Rename the files by removing the <code>-template</code> from the end of the file names.</p>
<div class="fragment"><div class="line">MathSenderComponentImpl.hpp</div>
<div class="line">MathSenderComponentImpl.cpp</div>
</div><!-- fragment --><p>Add the new files to the MathSender's <code>CMakeLists.txt</code> file:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentImpl.cpp&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Now attempt to build the component with:</p>
<div class="fragment"><div class="line">fprime-util build</div>
</div><!-- fragment --><p>The stub files should successfully compile.</p>
<h4><a class="anchor" id="autotoc_md109"></a>
2.4.1.2 Handler implementation</h4>
<p>The next step is to fill in the handler with implementation code.</p>
<p>First, find the empty command handler in the <code>MathSenderComponentImpl.cpp</code> file:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathSenderComponentImpl ::</div>
<div class="line">   MS_DO_MATH_cmdHandler(</div>
<div class="line">       const FwOpcodeType opCode,</div>
<div class="line">       const U32 cmdSeq,</div>
<div class="line">       F32 val1,</div>
<div class="line">       F32 val2,</div>
<div class="line">       MathOp operation</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">   // TODO</div>
<div class="line"> }</div>
</div><!-- fragment --><p>Then, fill in the function with the code to perform the functions described at the beginning of the tutorial:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathSenderComponentImpl ::</div>
<div class="line">   MS_DO_MATH_cmdHandler(</div>
<div class="line">       const FwOpcodeType opCode,</div>
<div class="line">       const U32 cmdSeq,</div>
<div class="line">       F32 val1,</div>
<div class="line">       F32 val2,</div>
<div class="line">       MathOp operation</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">   MathOpTlm opTlm;</div>
<div class="line">   MathOperation opPort;</div>
<div class="line">   MathOpEv opEv;</div>
<div class="line">   switch (operation) {</div>
<div class="line">     case ADD:</div>
<div class="line">         opTlm = ADD_TLM;</div>
<div class="line">         opPort = MATH_ADD;</div>
<div class="line">         opEv = ADD_EV;</div>
<div class="line">         break;</div>
<div class="line">     case SUBTRACT:</div>
<div class="line">         opTlm = SUB_TLM;</div>
<div class="line">         opPort = MATH_SUB;</div>
<div class="line">         opEv = SUB_EV;</div>
<div class="line">         break;</div>
<div class="line">     case MULTIPLY:</div>
<div class="line">         opTlm = MULT_TLM;</div>
<div class="line">         opPort = MATH_MULTIPLY;</div>
<div class="line">         opEv = MULT_EV;</div>
<div class="line">         break;</div>
<div class="line">     case DIVIDE:</div>
<div class="line">         opTlm = DIV_TLM;</div>
<div class="line">         opPort = MATH_DIVIDE;</div>
<div class="line">         opEv = DIV_EV;</div>
<div class="line">         break;</div>
<div class="line">     default:</div>
<div class="line">         FW_ASSERT(0,operation);</div>
<div class="line">         break;</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   this-&gt;tlmWrite_MS_OP(opTlm);</div>
<div class="line">   this-&gt;tlmWrite_MS_VAL1(val1);</div>
<div class="line">   this-&gt;tlmWrite_MS_VAL2(val2);</div>
<div class="line">   this-&gt;log_ACTIVITY_LO_MS_COMMAND_RECV(val1,val2,opEv);</div>
<div class="line">   this-&gt;mathOut_out(0,val1,val2,opPort);</div>
<div class="line">   // reply with completion status</div>
<div class="line">   this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div>
<div class="line"> }</div>
</div><!-- fragment --><p>The handler will send the appropriate events and telemetry values, then invoke the output math operation port to request the operation. Note that each channel and event argument that has an enumeration has a unique type declaration. Finally, note that the output command response port must be called with a command status in order to let the framework components know that the command is complete. If the completion status isn't sent, it will stall any sequences the command was part of. There are command error status along with successful completions. Most commands return this status at the end of the handler, but component implementations can store the <code>opCode</code> and <code>cmdSeq</code> values to return later, but those specific values must be returned in order to match the status with the command originally sent.</p>
<p>Find the empty result handler:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathSenderComponentImpl ::</div>
<div class="line">   mathIn_handler(</div>
<div class="line">       const NATIVE_INT_TYPE portNum,</div>
<div class="line">       F32 result</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">   // TODO</div>
<div class="line"> }</div>
</div><!-- fragment --><p>Fill in the result handler with code that reports telemetry and an event:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathSenderComponentImpl ::</div>
<div class="line">   mathIn_handler(</div>
<div class="line">       const NATIVE_INT_TYPE portNum,</div>
<div class="line">       F32 result</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">     this-&gt;tlmWrite_MS_RES(result);</div>
<div class="line">     this-&gt;log_ACTIVITY_HI_MS_RESULT(result);</div>
<div class="line"> }</div>
</div><!-- fragment --><p>This handler reports the result via a telemetry channel and an event.</p>
<p>Once complete, add the directory to the build and build the component by typing <code>fprime-util build</code> from the <code><a class="el" href="namespace_ref.html">Ref</a></code> directory.</p>
<h4><a class="anchor" id="autotoc_md110"></a>
2.4.1.3 Unit Tests</h4>
<p>Unit Tests are used to exercise the component's functions by invoking input ports and commands and checking the values of output ports, telemetry and events.</p>
<p><a class="anchor" id="autotoc_md111"></a></p><h5>2.4.1.3.1 Test Code Generation</h5>
<p>The code generator will generate test components that can be connected to the component to enable a set of unit tests to check functionality and to get coverage of all the code. To generate a set of files for testing, from the module directory type:</p>
<div class="fragment"><div class="line">fprime-util impl --ut</div>
</div><!-- fragment --><p>The files that are generated are:</p>
<div class="fragment"><div class="line">Tester.hpp</div>
<div class="line">Tester.cpp</div>
<div class="line">TesterBase.hpp</div>
<div class="line">TesterBase.cpp</div>
<div class="line">GTestBase.hpp</div>
<div class="line">GTestBase.cpp</div>
</div><!-- fragment --><p>The functions of the files are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File </th><th class="markdownTableHeadNone">Function  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TesterBase.* </td><td class="markdownTableBodyNone">Base class for test class. Defines necessary handlers as well as helper functions  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GTestBase.* </td><td class="markdownTableBodyNone">Helper class derived from TesterBase that has macros that use Google Test to test interfaces  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Tester.* </td><td class="markdownTableBodyNone">Derived tester class that inherits from GTestBase. Includes instance of the component and helpers to connect ports  </td></tr>
</table>
<p>Unit tests are built in subdirectories of the module, so the unit test file must be copied there. The build system supports a standard subdirectory of <code>test/ut</code> below the module being tested. While in the MathSender directory, create the <code>test/ut</code> directory:</p>
<div class="fragment"><div class="line">mkdir -p test/ut</div>
</div><!-- fragment --><p>Move the above set of files into that subdirectory.</p>
<p>The new unit test files have to be registered with the build system, so modifications to the <code>CMakeLists.txt</code> files are necessary. To do this, add a "UT_SOURCE_FILES" variable to <code>CMakeLists.txt</code> followed by a call <code>register_fprime_ut()</code>. The UT_SOURCE_FILES variable contains a list of the C++ files associated with the UT (see list above).</p>
<p>The final <code>CMakeLists.txt</code> file should look like the following:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentImpl.cpp&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
<div class="line"> </div>
<div class="line">set(UT_SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/main.cpp&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/Tester.cpp&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/TesterBase.cpp&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/GTestBase.cpp&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_ut()</div>
</div><!-- fragment --><p>The <code>UT_SOURCE_FILES</code> variable includes any source code needed to run the test. It usually only includes the generated test code and a <code>main.cpp</code>, but it can include any code the user needs to test.</p>
<p>A <code>UT_MODS</code> variable may be set should the UT depend on modules not automatically included by the component.</p>
<p><a class="anchor" id="autotoc_md112"></a></p><h5>2.4.1.3.2 Test Code Implementation</h5>
<p>The <code>main.cpp</code> file must be added. For this test, it appears like this:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &quot;Tester.hpp&quot;</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, AddOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testAddCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, SubOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testSubCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, MultOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testMultCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, DivideOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testDivCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int main(int argc, char **argv) {</div>
<div class="line">  ::testing::InitGoogleTest(&amp;argc, argv);</div>
<div class="line">  return RUN_ALL_TESTS();</div>
<div class="line">}</div>
</div><!-- fragment --><p>F' uses the Google Test framework to run unit tests. For more information about the Google Test Framework see here:</p>
<p><a href="https://github.com/google/googletest">https://github.com/google/googletest</a></p>
<p>In the Google Test framework, the following lines of code are standard:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">int main(int argc, char **argv) {</div>
<div class="line">  ::testing::InitGoogleTest(&amp;argc, argv);</div>
<div class="line">  return RUN_ALL_TESTS();</div>
<div class="line">}</div>
</div><!-- fragment --><p>For each test, there is a Google Test macro defined:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST(Name1, Name2) {</div>
<div class="line">    // run some code</div>
<div class="line">}</div>
</div><!-- fragment --><p>The code in each of the macros defined this way will automatically be run be the framework.</p>
<p>In this case, the tests are defined as follows:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST(Nominal, AddOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testAddCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, SubOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testSubCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, MultOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testMultCommand();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Nominal, DivideOperationTest) {</div>
<div class="line">    Ref::Tester tester;</div>
<div class="line">    tester.testDivCommand();</div>
<div class="line">}</div>
</div><!-- fragment --><p>For each unit test, the Google Test test case for F' components looks like:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST(Nominal, DivideOperationTest) {</div>
<div class="line">    NameSpace::Tester tester;</div>
<div class="line">    tester.someUnitTestFunc();</div>
<div class="line">}</div>
</div><!-- fragment --><p>The test component is instantiated here:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   NameSpace::Tester tester;</div>
</div><!-- fragment --><p>This allows the component to start from an newly initialized state for each unit test.</p>
<p>The unit test is executed by calling a member function of the <code>tester</code> class:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   tester.someUnitTestFunc();</div>
</div><!-- fragment --><p>The <code>Tester.hpp</code> stub can be updated to include the declarations of the unit test functions:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   ...</div>
<div class="line">   public:</div>
<div class="line"> </div>
<div class="line">     // ---------------------------------------------------------------------- </div>
<div class="line">     // Tests</div>
<div class="line">     // ---------------------------------------------------------------------- </div>
<div class="line"> </div>
<div class="line">     //! Test operation command</div>
<div class="line">     //!</div>
<div class="line">     void testAddCommand(void);</div>
<div class="line">     void testSubCommand(void);</div>
<div class="line">     void testMultCommand(void);</div>
<div class="line">     void testDivCommand(void);</div>
<div class="line"> </div>
<div class="line">   private:</div>
<div class="line">   ...</div>
</div><!-- fragment --><p>The next step is to add the specific test cases to the <code>Tester.cpp</code> implementation file. It is important to note that the unit tests are designed to be single-threaded. The active components do not have their threads started, so any messages to asynchronous ports are manually retrieved from the message queue and dispatched to handlers. This makes testing simpler since the execution of the thread in response to port calls or commands does not need to be managed. Examples of this will be seen in the test code.</p>
<p>The first test case will be to test the <code>MS_DO_MATH</code> command for the addition operation. In the example component implementation, <code>MS_DO_MATH</code> command calls the <code>mathOut</code> output port and emits some channelized telmetry and events. The test component provides methods for invoking the command and checking that the telemetry and events were emitted as expected. The steps to write the test case are as follows:</p>
<p>Add a member function to the implementation class in <code>Tester.cpp</code> to implement the test case:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> // ----------------------------------------------------------------------</div>
<div class="line"> // Tests </div>
<div class="line"> // ----------------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"> void Tester ::</div>
<div class="line">   testAddCommand(void)</div>
<div class="line"> {</div>
<div class="line">     // send MS_DO_MATH command</div>
<div class="line">     this-&gt;sendCmd_MS_DO_MATH(0,10,1.0,2.0,MathSenderComponentBase::ADD);</div>
<div class="line">     // retrieve the message from the message queue and dispatch the command to the handler</div>
<div class="line">     this-&gt;component.doDispatch();</div>
<div class="line">     // verify that that only one output port was called</div>
<div class="line">     ASSERT_FROM_PORT_HISTORY_SIZE(1);</div>
<div class="line">     // verify that the math operation port was only called once</div>
<div class="line">     ASSERT_from_mathOut_SIZE(1);</div>
<div class="line">     // verify the arguments of the operation port</div>
<div class="line">     ASSERT_from_mathOut(0,1.0,2.0,MATH_ADD);</div>
<div class="line">     // verify telemetry - 3 channels were written</div>
<div class="line">     ASSERT_TLM_SIZE(3);</div>
<div class="line">     // verify that the desired telemetry values were only sent once</div>
<div class="line">     ASSERT_TLM_MS_VAL1_SIZE(1);</div>
<div class="line">     ASSERT_TLM_MS_VAL2_SIZE(1);</div>
<div class="line">     ASSERT_TLM_MS_OP_SIZE(1);</div>
<div class="line">     // verify that the correct telemetry values were sent</div>
<div class="line">     ASSERT_TLM_MS_VAL1(0,1.0);</div>
<div class="line">     ASSERT_TLM_MS_VAL2(0,2.0);</div>
<div class="line">     ASSERT_TLM_MS_OP(0,MathSenderComponentBase::ADD_TLM);</div>
<div class="line">     // verify only one event was sent</div>
<div class="line">     ASSERT_EVENTS_SIZE(1);</div>
<div class="line">     // verify the expected event was only sent once</div>
<div class="line">     ASSERT_EVENTS_MS_COMMAND_RECV_SIZE(1);</div>
<div class="line">     // verify the correct event arguments were sent</div>
<div class="line">     ASSERT_EVENTS_MS_COMMAND_RECV(0,1.0,2.0,MathSenderComponentBase::ADD_EV);</div>
<div class="line">     // verify command response was sent</div>
<div class="line">     ASSERT_CMD_RESPONSE_SIZE(1);</div>
<div class="line">     // verify the command response was correct as expected</div>
<div class="line">     ASSERT_CMD_RESPONSE(0,MathSenderComponentBase::OPCODE_MS_DO_MATH,10,Fw::COMMAND_OK);</div>
<div class="line"> </div>
<div class="line">     // reset all telemetry and port history</div>
<div class="line">     this-&gt;clearHistory();</div>
<div class="line">     // call result port. We don&#39;t care about the value being correct since MathSender doesn&#39;t</div>
<div class="line">     this-&gt;invoke_to_mathIn(0,10.0);</div>
<div class="line">     // retrieve the message from the message queue and dispatch the command to the handler</div>
<div class="line">     this-&gt;component.doDispatch();</div>
<div class="line">     // verify only one telemetry value was written</div>
<div class="line">     ASSERT_TLM_SIZE(1);</div>
<div class="line">     // verify the desired telemetry channel was sent only once</div>
<div class="line">     ASSERT_TLM_MS_RES_SIZE(1);</div>
<div class="line">     // verify the values of the telemetry channel</div>
<div class="line">     ASSERT_TLM_MS_RES(0,10.0);</div>
<div class="line">     // verify only one event was sent</div>
<div class="line">     ASSERT_EVENTS_SIZE(1);</div>
<div class="line">     // verify the expected event was only sent once</div>
<div class="line">     ASSERT_EVENTS_MS_RESULT_SIZE(1);</div>
<div class="line">     // verify the expected value of the event arguments</div>
<div class="line">     ASSERT_EVENTS_MS_RESULT(0,10.0);     </div>
<div class="line"> }</div>
</div><!-- fragment --><p>Some highlights are:</p>
<p>Send the <code>MS_DO_MATH</code> command:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // send MS_DO_MATH command</div>
<div class="line">     this-&gt;sendCmd_MS_DO_MATH(0,10,1.0,2.0,MathSenderComponentBase::ADD);</div>
<div class="line">     // retrieve the message from the message queue and dispatch</div>
<div class="line">     this-&gt;component.doDispatch();</div>
</div><!-- fragment --><p>Verify that the operation port was called as expected:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // verify that that only one output port was called</div>
<div class="line">     ASSERT_FROM_PORT_HISTORY_SIZE(1);</div>
<div class="line">     // verify that the math operation port was only called once</div>
<div class="line">     ASSERT_from_mathOut_SIZE(1);</div>
<div class="line">     // verify the arguments of the operation port</div>
<div class="line">     ASSERT_from_mathOut(0,1.0,2.0,MATH_ADD);</div>
</div><!-- fragment --><p>The first call verifies that one and only one port call was made. This can be used to confirm that there were no other ports called besides the expected one.</p>
<p>The second call verifies that the port call that was made was the expected one.</p>
<p>The third call looks at a stored history of calls to this port and verifies the expected call arguments were made. The history can store multiple calls, so the first argument indicates which index in the history to examine.</p>
<p>Verify that the telemetry channels were written:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // verify telemetry - 3 channels were written</div>
<div class="line">     ASSERT_TLM_SIZE(3);</div>
<div class="line">     // verify that the desired telemetry values were only sent once</div>
<div class="line">     ASSERT_TLM_MS_VAL1_SIZE(1);</div>
<div class="line">     ASSERT_TLM_MS_VAL2_SIZE(1);</div>
<div class="line">     ASSERT_TLM_MS_OP_SIZE(1);</div>
<div class="line">     // verify that the correct telemetry values were sent</div>
<div class="line">     ASSERT_TLM_MS_VAL1(0,1.0);</div>
<div class="line">     ASSERT_TLM_MS_VAL2(0,2.0);</div>
<div class="line">     ASSERT_TLM_MS_OP(0,MathSenderComponentBase::ADD_TLM);</div>
</div><!-- fragment --><p>The first statement verifies that three channels were written as expected. The following statements verify that the correct channels were written with the expected values.</p>
<p>Verify that the event for the command was sent:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // verify only one event was sent</div>
<div class="line">     ASSERT_EVENTS_SIZE(1);</div>
<div class="line">     // verify the expected event was only sent once</div>
<div class="line">     ASSERT_EVENTS_MS_COMMAND_RECV_SIZE(1);</div>
<div class="line">     // verify the correct event arguments were sent</div>
<div class="line">     ASSERT_EVENTS_MS_COMMAND_RECV(0,1.0,2.0,MathSenderComponentBase::ADD_EV);</div>
</div><!-- fragment --><p>Next, verify that the correct response to the command was sent:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // verify command response was sent</div>
<div class="line">     ASSERT_CMD_RESPONSE_SIZE(1);</div>
<div class="line">     // verify the command response was correct as expected</div>
<div class="line">     ASSERT_CMD_RESPONSE(0,MathSenderComponentBase::OPCODE_MS_DO_MATH,10,Fw::COMMAND_OK);</div>
</div><!-- fragment --><p>Next, prepare for calling <code>MathSender</code>'s result port by clearing the port and telemetry history:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // reset all telemetry and port history</div>
<div class="line">     this-&gt;clearHistory();</div>
</div><!-- fragment --><p>As ports and commands are invoked in the component, the test component stores the history of calls. This function clears the history, in order to provide a clean slate for the next test. There are calls to clear individual histories as well. See <code>TesterBase.hpp</code> for a list. The <code>this-&gt;clearHistory()</code> call will clear them all, so is generally preferable.</p>
<p>The next step is to invoke the port that the <code>MathReceiver</code> component will call in the example program. For the unit test, the <code>MathReceiver</code> is not present to send the result back, so the unit test will emulate that call.</p>
<p>First, the port invocation is made:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // call result port. We don&#39;t care about the value being correct since MathSender doesn&#39;t</div>
<div class="line">     this-&gt;invoke_to_mathIn(0,10.0);</div>
<div class="line">     // retrieve the message from the message queue and dispatch the command to the handler</div>
<div class="line">     this-&gt;component.doDispatch();</div>
</div><!-- fragment --><p>Next, the test checks for the expected telemetry and events:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // verify only one telemetry value was written</div>
<div class="line">     ASSERT_TLM_SIZE(1);</div>
<div class="line">     // verify the desired telemetry channel was sent only once</div>
<div class="line">     ASSERT_TLM_MS_RES_SIZE(1);</div>
<div class="line">     // verify the values of the telemetry channel</div>
<div class="line">     ASSERT_TLM_MS_RES(0,10.0);</div>
<div class="line">     // verify only one event was sent</div>
<div class="line">     ASSERT_EVENTS_SIZE(1);</div>
<div class="line">     // verify the expected event was only sent once</div>
<div class="line">     ASSERT_EVENTS_MS_RESULT_SIZE(1);</div>
<div class="line">     // verify the expected value of the event</div>
<div class="line">     ASSERT_EVENTS_MS_RESULT(0,10.0);     </div>
</div><!-- fragment --><p>The other test cases are similarly implemented for the other operations. See the tutorial code for their implementation.</p>
<p>To build the unit test, type:</p>
<div class="fragment"><div class="line">fprime-util build --ut</div>
</div><!-- fragment --><p>The unit test can be run by typing the following in the <code>MathSender</code> (not <code>test/ut</code>) directory:</p>
<div class="fragment"><div class="line">$ fprime-util check</div>
<div class="line">[==========] Running 4 tests from 1 test case.</div>
<div class="line">[----------] Global test environment set-up.</div>
<div class="line">[----------] 4 tests from Nominal</div>
<div class="line">[ RUN      ] Nominal.AddOperationTest</div>
<div class="line">[       OK ] Nominal.AddOperationTest (2 ms)</div>
<div class="line">[ RUN      ] Nominal.SubOperationTest</div>
<div class="line">[       OK ] Nominal.SubOperationTest (0 ms)</div>
<div class="line">[ RUN      ] Nominal.MultOperationTest</div>
<div class="line">[       OK ] Nominal.MultOperationTest (0 ms)</div>
<div class="line">[ RUN      ] Nominal.DivideOperationTest</div>
<div class="line">[       OK ] Nominal.DivideOperationTest (0 ms)</div>
<div class="line">[----------] 4 tests from Nominal (3 ms total)</div>
<div class="line"> </div>
<div class="line">[----------] Global test environment tear-down</div>
<div class="line">[==========] 4 tests from 1 test case ran. (3 ms total)</div>
<div class="line">[  PASSED  ] 4 tests.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md113"></a>
2.4.2 MathReceiver Implementation</h3>
<h4><a class="anchor" id="autotoc_md114"></a>
2.4.2.1 Component Implementation</h4>
<p>As before, a stub can be generated:</p>
<div class="fragment"><div class="line">cd fprime/Ref/MathReceiver</div>
<div class="line">fprime-util impl</div>
<div class="line">mv MathReceiverComponentImpl.cpp-template MathReceiverComponentImpl.cpp</div>
<div class="line">mv MathReceiverComponentImpl.hpp-template MathReceiverComponentImpl.hpp</div>
</div><!-- fragment --><p>Add the stub files to <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">set(SOURCE_FILES</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponent.xml&quot;</div>
<div class="line">  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponentImpl.cpp&quot;</div>
<div class="line">)</div>
<div class="line">register_fprime_module()</div>
</div><!-- fragment --><p>Add the files and compile them: <code>fprime-util build</code></p>
<p><a class="anchor" id="autotoc_md115"></a></p><h5>2.4.2.1.1 Port handler</h5>
<p>Look for the empty port hander in the sub class:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">   mathIn_handler(</div>
<div class="line">       const NATIVE_INT_TYPE portNum,</div>
<div class="line">       F32 val1,</div>
<div class="line">       F32 val2,</div>
<div class="line">       MathOperation operation</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">   // TODO</div>
<div class="line"> }</div>
</div><!-- fragment --><p>Fill the handler in with the computation of the result. The handler will also update telemetry and events:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">   mathIn_handler(</div>
<div class="line">       const NATIVE_INT_TYPE portNum,</div>
<div class="line">       F32 val1,</div>
<div class="line">       F32 val2,</div>
<div class="line">       MathOperation operation</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">     // declare result serializable</div>
<div class="line">     Ref::MathOp op;</div>
<div class="line">     F32 res = 0.0;</div>
<div class="line">     switch (operation) {</div>
<div class="line">         case MATH_ADD:</div>
<div class="line">             op.setop(ADD);</div>
<div class="line">             res = (val1 + val2)*this-&gt;m_factor1;</div>
<div class="line">             break;</div>
<div class="line">         case MATH_SUB:</div>
<div class="line">             op.setop(SUB);</div>
<div class="line">             res = (val1 - val2)*this-&gt;m_factor1;</div>
<div class="line">             break;</div>
<div class="line">         case MATH_MULTIPLY:</div>
<div class="line">             op.setop(MULT);</div>
<div class="line">             res = (val1 * val2)*this-&gt;m_factor1;</div>
<div class="line">             break;</div>
<div class="line">         case MATH_DIVIDE:</div>
<div class="line">             op.setop(DIVIDE);</div>
<div class="line">             res = (val1 / val2)*this-&gt;m_factor1;</div>
<div class="line">             break;</div>
<div class="line">         default:</div>
<div class="line">             FW_ASSERT(0,operation);</div>
<div class="line">             break;</div>
<div class="line">     }</div>
<div class="line">     Fw::ParamValid valid;</div>
<div class="line">     res = res/paramGet_factor2(valid);</div>
<div class="line"> </div>
<div class="line">     op.setval1(val1);</div>
<div class="line">     op.setval2(val2);</div>
<div class="line">     op.setresult(res);</div>
<div class="line">     this-&gt;log_ACTIVITY_HI_MR_OPERATION_PERFORMED(op);</div>
<div class="line">     this-&gt;tlmWrite_MR_OPERATION(op);</div>
<div class="line">     this-&gt;mathOut_out(0,res);</div>
<div class="line"> }</div>
</div><!-- fragment --><p>If needed, add <code>m_factor1</code> and <code>m_factor1s</code> as private variables in <code>MathReceiverComponentImpl.hpp</code>:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">//! Implementation for MR_CLEAR_EVENT_THROTTLE command handler</div>
<div class="line">//! Clear the event throttle</div>
<div class="line">void MR_CLEAR_EVENT_THROTTLE_cmdHandler(</div>
<div class="line">    const FwOpcodeType opCode, /*!&lt; The opcode*/</div>
<div class="line">    const U32 cmdSeq /*!&lt; The command sequence number*/</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">// stored factor1</div>
<div class="line">F32 m_factor1;</div>
<div class="line">// number of times factor1 has been written</div>
<div class="line">U32 m_factor1s;</div>
</div><!-- fragment --><p>In this handler, the operation is done based on the port arguments from <code>MathSender</code>. The <code>op</code> structure is populated for the event and telemetry calls, and the <code>mathOut</code> port is called to send the result back to <code>MathSender</code>. The parameter value is retrieved during initialization and is returned via the <code>paramGet_factor2()</code> call. The commands to set and save the factor2 parameter run entirely in the code generated base classes.</p>
<p><a class="anchor" id="autotoc_md116"></a></p><h5>2.4.2.1.2 Commands</h5>
<p>The command handler to update the value of <code>factor1</code> is as follows:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">   MR_SET_FACTOR1_cmdHandler(</div>
<div class="line">       const FwOpcodeType opCode,</div>
<div class="line">       const U32 cmdSeq,</div>
<div class="line">       F32 val</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">     this-&gt;m_factor1 = val;</div>
<div class="line">     this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1(val);</div>
<div class="line">     this-&gt;tlmWrite_MR_FACTOR1(val);</div>
<div class="line">     this-&gt;tlmWrite_MR_FACTOR1S(++this-&gt;m_factor1s);</div>
<div class="line">     // reply with completion status</div>
<div class="line">     this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div>
<div class="line"> }</div>
</div><!-- fragment --><p>The telemetry and log values are sent, and the command response is sent. Note that after three calls to the handler, the <code>this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1(val)</code> call will not actually send any events until the throttle is cleared. The throttled state is part of the generated code.</p>
<p>The handler to clear the throttle is as follows:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">   MR_CLEAR_EVENT_THROTTLE_cmdHandler(</div>
<div class="line">       const FwOpcodeType opCode,</div>
<div class="line">       const U32 cmdSeq</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">     // clear throttle</div>
<div class="line">     this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1_ThrottleClear();</div>
<div class="line">     // send event that throttle is cleared</div>
<div class="line">     this-&gt;log_ACTIVITY_HI_MR_THROTTLE_CLEARED();</div>
<div class="line">     // reply with completion status</div>
<div class="line">     this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div>
<div class="line"> }</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md117"></a></p><h5>2.4.2.1.3 Scheduler Call</h5>
<p>The port invoked by the scheduler retrieves the messages from the message queue and dispatches them. The message dispatches invoke the command and input port handlers that were implemented earlier in the tutorial.</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">   SchedIn_handler(</div>
<div class="line">       const NATIVE_INT_TYPE portNum,</div>
<div class="line">       NATIVE_UINT_TYPE context</div>
<div class="line">   )</div>
<div class="line"> {</div>
<div class="line">     QueuedComponentBase::MsgDispatchStatus stat = QueuedComponentBase::MSG_DISPATCH_OK;</div>
<div class="line">     // empty message queue</div>
<div class="line">     while (stat != MSG_DISPATCH_EMPTY) {</div>
<div class="line">         stat = this-&gt;doDispatch();</div>
<div class="line">     }</div>
<div class="line"> }</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md118"></a></p><h5>2.4.2.1.4 Parameter Updates</h5>
<p>The developer can optionally receive a notification that a parameter has been updated by overriding a virtual function in the code generated base class:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void MathReceiverComponentImpl ::</div>
<div class="line">    parameterUpdated(</div>
<div class="line">     FwPrmIdType id /*!&lt; The parameter ID*/</div>
<div class="line"> ) {</div>
<div class="line">     if (id == PARAMID_FACTOR2) {</div>
<div class="line">       Fw::ParamValid valid;</div>
<div class="line">       F32 val = this-&gt;paramGet_factor2(valid);</div>
<div class="line">       this-&gt;log_ACTIVITY_HI_MR_UPDATED_FACTOR2(val);</div>
<div class="line">     }</div>
<div class="line"> }</div>
</div><!-- fragment --><p>Add the function to the header file:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">// stored factor1</div>
<div class="line"> F32 m_factor1;</div>
<div class="line"> // number of times factor1 has been written</div>
<div class="line"> U32 m_factor1s;</div>
<div class="line"> </div>
<div class="line"> void parameterUpdated(</div>
<div class="line">     FwPrmIdType id /*!&lt; The parameter ID*/</div>
<div class="line"> );</div>
</div><!-- fragment --><p>Once it is added, add the directory to the build and build the component by typing <code>fprime-util build</code> from the <code><a class="el" href="namespace_ref.html">Ref</a></code> directory.</p>
<h4><a class="anchor" id="autotoc_md119"></a>
2.4.2.2 Unit Tests</h4>
<p>See section <code>2.4.1.3.1</code> for directions on how to generate unit test stubs and copy them to the correct subdirectory. The <code>MathReceiver</code> tests are similar to <code>MathSender</code>.</p>
<p><a class="anchor" id="autotoc_md120"></a></p><h5>2.4.2.2.1 Test Code Implementation</h5>
<p>The full unit test code for the <code>MathReceiver</code> component can be found in the <code>docs/Tutorials/MathComponent/MathReceiver/test/ut</code> directory. Many of the patterns are the same. Following are some highlights:</p>
<p><a class="anchor" id="autotoc_md121"></a></p><h5>2.4.2.2.2 Parameter Initialization</h5>
<p><code>Tester.cpp</code>, line 60:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void Tester ::</div>
<div class="line">   testAddCommand(void) </div>
<div class="line"> {</div>
<div class="line">     // load parameters</div>
<div class="line">     this-&gt;component.loadParameters();</div>
<div class="line">     ...</div>
</div><!-- fragment --><p>The <code>loadParameters()</code> call will attempt to load any parameters that the component needs. The <code>this-&gt;paramSet_*</code> functions in the <code>*TesterBase</code> base classes allow the developer to set parameter and status values prior to the <code>loadParameters()</code> With no manually set parameter values preceding the call, in this test case the parameter value is set to the default value. It is a way to test default settings for parameters.</p>
<p><code>Tester.cpp</code>, line 206:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void Tester ::</div>
<div class="line">   testSubCommand(void) </div>
<div class="line"> {</div>
<div class="line">     // set the test value for the parameter before loading - it will be initialized to this value</div>
<div class="line">     this-&gt;paramSet_factor2(5.0,Fw::PARAM_VALID);</div>
<div class="line"> </div>
<div class="line">     // load parameters</div>
<div class="line">     this-&gt;component.loadParameters();</div>
</div><!-- fragment --><p>In this test case, the parameter value was set prior to the <code>loadParameters()</code> call. A <code>Fw::PARAM_VALID</code> status is also set, which allows the component consider the value valid and use it.</p>
<p><a class="anchor" id="autotoc_md122"></a></p><h5>2.4.2.2.3 Serializable Usage</h5>
<p><code>Tester.cpp</code>, line 78:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     ...</div>
<div class="line">     // verify the result of the operation was returned</div>
<div class="line">     F32 result = (2.0-3.0)*2.0/5.0;</div>
<div class="line">     // the event and telemetry channel use the Ref::MathOp type for values</div>
<div class="line">     Ref::MathOp checkOp(2.0,3.0,Ref::SUB,result);</div>
<div class="line">     ...</div>
</div><!-- fragment --><p>The <code>Ref::Mathop</code> class is the C++ implementation of the serializable type defined in <code>2.2.1</code>. When checking event and telemetry histories against the expected values, simply instantiate the serializable class in the test code and use it for comparisons.</p>
<p><a class="anchor" id="autotoc_md123"></a></p><h5>2.4.2.2.4 Event Throttling</h5>
<p><code>Tester.cpp</code>, line 395:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> void Tester ::</div>
<div class="line">   testThrottle(void) </div>
<div class="line"> {</div>
</div><!-- fragment --><p>This unit test demonstrates how event throttling works. The event is repeatedly issued until it reaches the throttle count and then is suppressed from then on. The throttle is reset by the <code>MR_CLEAR_EVENT_THROTTLE</code> command:</p>
<p><code>Tester.cpp</code>, line 446:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">     // send the command to clear the throttle</div>
<div class="line">     this-&gt;sendCmd_MR_CLEAR_EVENT_THROTTLE(0,10);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md124"></a>
3 Topology</h1>
<p>Now that the two components are defined, implemented and unit tested they can to be added to the <code><a class="el" href="namespace_ref.html">Ref</a></code> topology. The topology describes the interconnection of all the components so the system operates as intended. They consist of the core Command and Data Handling (C&amp;DH) components that are part of the reusable set of components that come with the F´ repository as well as custom components written for the <code><a class="el" href="namespace_ref.html">Ref</a></code> reference example including the ones in this tutorial. The <code><a class="el" href="namespace_ref.html">Ref</a></code> topology has already been developed as an example. The tutorial will add the <code>MathSender</code> and <code>MathReceiver</code> components to the existing demonstration. It involves modification of a topology description XML file as well as accompanying C++ code to instantiate and initialize the components.</p>
<h2><a class="anchor" id="autotoc_md125"></a>
3.1 Define C++ Component Instances</h2>
<p>The first step is to include the implementation files in the topology source code.</p>
<h3><a class="anchor" id="autotoc_md126"></a>
3.1.1 Components.hpp</h3>
<p>There is a C++ header file that declares all the component instances as externals for use by the initialization code and the generated code that interconnects the components. The two new components can be added to this file. First, include the header files for the implementation classes:</p>
<p><code>Ref/Top/Components.hpp</code>, line 30:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &lt;Drv/BlockDriver/BlockDriverImpl.hpp&gt;</div>
<div class="line"> </div>
<div class="line">#include &lt;Ref/MathSender/MathSenderComponentImpl.hpp&gt;</div>
<div class="line">#include &lt;Ref/MathReceiver/MathReceiverComponentImpl.hpp&gt;</div>
</div><!-- fragment --><p><code>extern</code> declarations need to be made in this header file for use by the topology connection file that is discussed later as well as initialization code.</p>
<p><code>Ref/Top/Components.hpp</code>, line 61:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">extern Ref::PingReceiverComponentImpl pingRcvr;</div>
<div class="line"> </div>
<div class="line">extern Ref::MathSenderComponentImpl mathSender;</div>
<div class="line">extern Ref::MathReceiverComponentImpl mathReceiver;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md127"></a>
3.1.2 Topology.cpp</h3>
<p>This C++ file is where the instances of the all the components are declared and initialized. The generated topology connection function is called from this file.</p>
<h4><a class="anchor" id="autotoc_md128"></a>
3.1.2.1 Component Instantiation</h4>
<p>Put these declarations after the declarations for the other <code><a class="el" href="namespace_ref.html">Ref</a></code> components:</p>
<p><code>Ref/Top/Topology.cpp</code>, line 187:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">Ref::MathSenderComponentImpl mathSender(FW_OPTIONAL_NAME(&quot;mathSender&quot;));</div>
<div class="line">Ref::MathReceiverComponentImpl mathReceiver(FW_OPTIONAL_NAME(&quot;mathReceiver&quot;));</div>
</div><!-- fragment --><p>Where the other components are initialzed, add <code>MathSender</code> and <code>MathReceiver</code>:</p>
<p><code>Ref/Top/Topology.cpp</code>, line 286:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   pingRcvr.init(10);</div>
<div class="line"> </div>
<div class="line">   mathSender.init(10,0);</div>
<div class="line">   mathReceiver.init(10,0);</div>
</div><!-- fragment --><p>The first argument is the queue message depth. This is the number of messages that can be pending while other messages are being dispatched.</p>
<p>After all the components are initialized, the generated function <code>constructRefArchitecture()</code> (see <code>RefTopologyAppAc.cpp</code>) can be called to connect the components together. How this function is generated will be seen later in the tutorial.</p>
<p><code>Ref/Top/Topology.cpp</code>, line 291:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   // call generated function to connect components</div>
<div class="line">   constructRefArchitecture();</div>
</div><!-- fragment --><p>Next, the components commands are registered.</p>
<p><code>Ref/Top/Topology.cpp</code>, line 308:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   health.regCommands();</div>
<div class="line">   pingRcvr.regCommands();</div>
<div class="line"> </div>
<div class="line">   mathSender.regCommands();</div>
<div class="line">   mathReceiver.regCommands();</div>
</div><!-- fragment --><p>Component parameters are retrieved from disk by <code>prmDb</code> prior to the components requesting them:</p>
<p><code>Ref/Top/Topology.cpp</code>, line 314:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   // read parameters</div>
<div class="line">   prmDb.readParamFile();</div>
</div><!-- fragment --><p>Once the parameters are read by <code>prmDb</code>, the components can request them:</p>
<p><code>Ref/Top/Topology.cpp</code>, line 300:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   sendBuffComp.loadParameters();</div>
<div class="line"> </div>
<div class="line">   mathReceiver.loadParameters();</div>
</div><!-- fragment --><p>The thread for the active <code>MathSender</code> component needs to be started:</p>
<p><code>Ref/Top/Topology.cpp</code>, line 357:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   pingRcvr.start(0, 100, 10*1024);</div>
<div class="line"> </div>
<div class="line">   mathSender.start(0,100,10*1024);</div>
</div><!-- fragment --><p>The arguments to the <code>start()</code> function is as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Argument </th><th class="markdownTableHeadNone">Usage  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">Thread ID, unique value for each thread. Not used for Linux  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">Thread priority. Passed to underlying OS  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">Thread stack size. Passed to underlying OS  </td></tr>
</table>
<p>The <code>MathReceiver</code> queued component will execute on the thread of the 1Hz rate group, which will be shown later. It does not need to to have a thread started, since queued components do not have threads.</p>
<p>The <code>exitTasks()</code> function is called when the process is shut down. It contains <code>exit()</code> calls to all the active components. These functions internally send a message to the component's thread to shut down.</p>
<p><code>Ref/Top/Topology.cpp</code>, line 396:</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   cmdSeq.exit();</div>
<div class="line"> </div>
<div class="line">   mathSender.exit();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md129"></a>
3.2 Define Component Connections</h2>
<p>Components need to be connected to invoke each other via ports. The connections are specified via a topology XML file. The file for the <a class="el" href="namespace_ref.html">Ref</a> example is located in <code>Ref/Top/RefTopologyAppAi.xml</code> The connections for the new components will be added to the existing connections.</p>
<h3><a class="anchor" id="autotoc_md130"></a>
3.2.1 Component Imports</h3>
<p>The component XML definitions must be imported into the topology file:</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 32:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">import_component_type</span>&gt;<span class="keyword">Svc</span>/<span class="keyword">PassiveTextLogger</span>/<span class="keyword">PassiveTextLoggerComponentAi.xml</span>&lt;/<span class="keywordtype">import_component_type</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">import_component_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathSender</span>/<span class="keyword">MathSenderComponentAi.xml</span>&lt;/<span class="keywordtype">import_component_type</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">import_component_type</span>&gt;<span class="keyword">Ref</span>/<span class="keyword">MathReceiver</span>/<span class="keyword">MathReceiverComponentAi.xml</span>&lt;/<span class="keywordtype">import_component_type</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md131"></a>
3.2.2 Component Instances</h3>
<p>The Component instances must be declared.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 92:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">instance</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Svc&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;textLogger&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;PassiveTextLogger&quot;</span> <span class="keyword">base_id</span>=<span class="stringliteral">&quot;521&quot;</span>  <span class="keyword">base_id_window</span>=<span class="stringliteral">&quot;20&quot;</span> /&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">instance</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;MathSender&quot;</span> <span class="keyword">base_id</span>=<span class="stringliteral">&quot;1000&quot;</span>  <span class="keyword">base_id_window</span>=<span class="stringliteral">&quot;20&quot;</span> /&gt;</div>
<div class="line">&lt;<span class="keywordtype">instance</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;MathReceiver&quot;</span> <span class="keyword">base_id</span>=<span class="stringliteral">&quot;1100&quot;</span>  <span class="keyword">base_id_window</span>=<span class="stringliteral">&quot;20&quot;</span> /&gt;</div>
</div><!-- fragment --><p>The name in the <code>name=</code> attribute must match the one declared previously in <code>Ref/Top/Components.hpp</code>. For example:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">extern Ref::MathSenderComponentImpl mathSender;</div>
</div><!-- fragment --><p>The type must match the type declared in the component XML:</p>
<p><code>Ref/MathSender/MathSenderComponentAi.xml</code>:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">component</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MathSender&quot;</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;active&quot;</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;Ref&quot;</span>&gt;</div>
</div><!-- fragment --><p>The <code>base_id</code> attribute specifies the beginning range of the assigned IDs for commands, telemetry, events, and parameters. The values declared in the component XML are added to this base address. This allows multiple instances of components to be declared with unique ID ranges. The <code>base_id_window</code> attribute is used to set a limit on ID ranges for spacing the base IDs from different components sufficiently apart. If the IDs exceed the limit, the code generator will issue a warning.</p>
<h3><a class="anchor" id="autotoc_md132"></a>
3.2.3 Command connections</h3>
<p>The command connections should follow these rules:</p>
<ol type="1">
<li>The port number of the command registration port on the <code>cmdDisp</code> component connection from the commanded components must be unique for all components.</li>
<li>The port number of the command dispatch port connection from the <code>cmdDisp</code> component to the commanded component must match the registration port number.</li>
<li>The command status from the components can go to port 0 of the command status port of the <code>cmdDisp</code> component.</li>
</ol>
<p>The following XML shows the command connection for the tutorial components.</p>
<p>The port number used for the registration and dispatch ports is selected as 20, a unique number that hasn't been used yet in the <code><a class="el" href="namespace_ref.html">Ref</a></code> example.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 817:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Command Registration Ports - Registration port number must match dispatch port for each component --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderReg&quot;</span>&gt;</div>
<div class="line">     &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdReg&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;20&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverReg&quot;</span>&gt;</div>
<div class="line">     &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdReg&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdReg&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;21&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">&lt;!-- Command Dispatch Ports - Dispatch port number must match registration port for each component --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderDisp&quot;</span>&gt;</div>
<div class="line">     &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdSend&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Cmd&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;20&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdDisp&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Cmd&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverDisp&quot;</span>&gt;</div>
<div class="line">     &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdSend&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Cmd&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;21&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdDisp&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Cmd&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">&lt;!-- Command Reply Ports - Go to the same response port on the dispatcher --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderReply&quot;</span>&gt;</div>
<div class="line">   &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdStatus&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdResponse&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">   &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdStat&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdResponse&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverReply&quot;</span>&gt;</div>
<div class="line">   &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;CmdStatus&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdResponse&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">   &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;cmdDisp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;compCmdStat&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;CmdResponse&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md133"></a>
3.2.4 Event Connections</h3>
<p>The output connections for log ports are connected to the <code>eventLogger</code> component.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 845:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Event Logger Binary Connections --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderLog&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;eventLogger&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;LogRecv&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverLog&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;eventLogger&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;LogRecv&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Log&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line"> </div>
<div class="line"><span class="comment">&lt;!-- Event Logger Text Connections --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderTextLog&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;textLogger&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;TextLogger&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverTextLog&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;textLogger&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;TextLogger&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;LogText&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><p>There are two kinds of connections for logging: One for a binary form that will be sent to the ground system, and a text version for displaying on standard output of the target machine.</p>
<h3><a class="anchor" id="autotoc_md134"></a>
3.2.5 Telemetry Connections</h3>
<p>The telemetry output ports are connected to the <code>chanTlm</code> component.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 872:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Telemetry Connections --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderTextTlm&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;chanTlm&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;TlmRecv&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverTextTlm&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;chanTlm&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;TlmRecv&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Tlm&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md135"></a>
3.2.6 Parameter Connections</h3>
<p>There are two parameter connections, a <code>PrmGet</code> connection for reading parameters during software initialization and a <code>PrmSet</code> for updating parameters in the component that manages parameter values. F' has a basic parameter storage component <code>prmDb</code> that stores parameters in files. Upon bootup, they are read from a file specified in the constructor and stored in memory. Subsequent to this, components request their parameters via the <code>PrmGet</code> connection. If they are updated by command, they can be saved to storage by issuing a command to call the <code>PrmSet</code> with the new value and issuing the <code>PRM_SAVE_FILE</code> command.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 883:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Parameter Connections --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverPrmGet&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;ParamGet&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;PrmGet&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;prmDb&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;getPrm&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;PrmGet&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverPrmSet&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;ParamSet&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;PrmSet&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;prmDb&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;setPrm&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;PrmSet&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md136"></a>
3.2.7 Time Connections</h3>
<p>Components that have telemetry or events need to be able to time stamp the events. The time connections connect the components to a time source to provide the time stamps.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 894:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Time Connections --&gt;</span></div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathSenderTime&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;linuxTime&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;timeGetPort&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverTime&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;linuxTime&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;timeGetPort&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Time&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md137"></a>
3.2.8 Scheduler Connection</h3>
<p>The <code>MathReceiver</code> component does not have a thread of its own, but relies on the thread of another component to drive it via the <code>SchedIn</code> port. The <code>SchedIn</code> port is connected to the 1Hz rate group component that is part of the <code><a class="el" href="namespace_ref.html">Ref</a></code> example. This means that every second the component gets a call and can unload messages from its message queue and dispatch them to handlers.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 894:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Scheduler Connection --&gt;</span></div>
<div class="line"> &lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathReceiverRG&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;rateGroup1Comp&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;RateGroupMemberOut&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Sched&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;3&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;SchedIn&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Sched&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line"> &lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md138"></a>
3.2.9 The Math Operation Connection</h3>
<p>The final connection is the connection that performs the math operation. It goes from <code>MathSender</code> to <code>MathReceiver</code>.</p>
<p><code>Ref/Top/RefTopologyAppAi.xml</code>, line 911:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Math Connection --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathOpConnection&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;mathOut&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Ref::MathOp&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;mathIn&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Ref::MathOp&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">connection</span> <span class="keyword">name</span> = <span class="stringliteral">&quot;MathResultConnection&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">source</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathReceiver&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;mathOut&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Ref::MathResult&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">     &lt;<span class="keywordtype">target</span> <span class="keyword">component</span> = <span class="stringliteral">&quot;mathSender&quot;</span> <span class="keyword">port</span> = <span class="stringliteral">&quot;mathIn&quot;</span> <span class="keyword">type</span> = <span class="stringliteral">&quot;Ref::MathResult&quot;</span> <span class="keyword">num</span> = <span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">connection</span>&gt;</div>
</div><!-- fragment --><p>Once all the updates to the topology file have been made, the module can be built by typing <code>fprime-util build</code> at the command line in the <code>Ref/Top</code> directory. If the updates were correct, the module should compile with no errors. The overall <code><a class="el" href="namespace_ref.html">Ref</a></code> deployment can be built by changing to the <code><a class="el" href="namespace_ref.html">Ref</a></code> directory and typing <code>fprime-util build</code>. Once the build passes, you should also run the installation of the <code><a class="el" href="namespace_ref.html">Ref</a></code> deployment using by typing <code>fprime-util install</code>.</p>
<p>If running on a different platform, you can specify the build target by typing <code>fprime-util generate &lt;target&gt;</code>.</p>
<h1><a class="anchor" id="autotoc_md139"></a>
4 Executing the Example</h1>
<p>We are now ready to run the ground system. Before the user runs this build system, ensure that the install command has been run. This is accomplished with the following commands:</p>
<div class="fragment"><div class="line">cd fprime/Ref</div>
<div class="line">fprime-util install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md140"></a>
4.1 Running the Ground System</h2>
<p>Once the <code><a class="el" href="namespace_ref.html">Ref</a></code> example has successfully built, the ground system and executable can be run by typing <code>fprime-gds -d fprime/Ref</code>. The ground system GUI should appear:</p>
<h3><a class="anchor" id="autotoc_md141"></a>
4.1.1 Executing Commands</h3>
<p>Commands can be executed by selecting the <code>Commands</code> tab and clicking on the <code>Cmds</code> drop-down list.</p>
<p>For the tutorial example, select the <code>MathSender</code> command <code>MS_DO_MATH</code> and fill in the arguments.</p>
<p>Clicking on the <code>Send</code> button will send the command to the software. When the command is sent, it is placed in the command history. It can be selected and sent again if the user desires.</p>
<h3><a class="anchor" id="autotoc_md142"></a>
4.1.2 Checking Events</h3>
<p>The <code>Events</code> tab shows events that are generated by the software. For the tutorial, the events tab shows the events that were sent by the <code>MS_DO_MATH</code> command:</p>
<p>It shows the F' <code>CmdDispatcher</code> event indicating a command was dispatched and completed. It also has the events defined by the tutorial example that are sent as a results of requesting a math operation. The result is zero, since the <code>factor1</code> value is zero, as shown in the unit testing in section <code>2.4.2.2</code>.</p>
<p>The events are also echoed to <code>stdout</code> of the application, which can be found in the <code>Logs</code> tab, selecting "Ref.log" in the dropdown.</p>
<h3><a class="anchor" id="autotoc_md143"></a>
4.1.3 Checking Telemetry</h3>
<p>The <code>Channel Telemetry</code> tab shows channelized telemetry sent by the software. The channels defined by the tutorial have the last values and time they were updated:</p>
<h3><a class="anchor" id="autotoc_md144"></a>
4.1.5 Updating &lt;tt&gt;factor1&lt;/tt&gt;</h3>
<p>In order to get a non-zero result, <code>factor1</code> needs to be updated. The tutorial defined a command to update it, <code>MR_SET_FACTOR1</code>. It can be selected from the command tab:</p>
<p>When the command is executed, the <code>Log Events</code> tab will show the event indicating the value was updated.</p>
<p>The <code>Channel Telemetry</code> tab shows the two channels related to the update. <code>MR_FACTOR1</code> shows the new value, while <code>MR_FACTOR1S</code> show how many times the value has been updated.</p>
<h3><a class="anchor" id="autotoc_md145"></a>
4.1.6 Running the Command Again</h3>
<p>After <code>factor1</code> has been updated, the command can be repeated:</p>
<h3><a class="anchor" id="autotoc_md146"></a>
4.1.7 Updated Events and Telemetry</h3>
<p>The new events will appear in the <code>Log Events</code> tab:</p>
<p>Notice that the updated events are added to the end of the log, since events are meant to be a record of events in the software.</p>
<p>The <code>Channel Telemetry</code> tab will also show the updated values:</p>
<p>Notice that the <code>MS_OP</code>, <code>MS_VAL1</code>, <code>MS_VAL2</code>, <code>MR_OPERATION</code>, and <code>MS_RESULT</code> are updated to the latest value with a more recent time stamp, since telemetry channels are meant to show the latest value. The new result is <code>10.0</code> now that <code>factor1</code> has been updated.</p>
<h3><a class="anchor" id="autotoc_md147"></a>
4.1.8 Parameter Updates</h3>
<p>The tutorial defined a <code>factor2</code> parameter in the <code>MathReceiver</code> component. The code generator creates two commands for each parameter: <code>XXXX_PRM_SET</code> and <code>XXX_PRM_SAVE</code> where <code>XXX</code> is an upper case version of the parameter name. The <code>FACTOR2_PRM_SET</code> command will set the value in <code>MathReceiver</code>, while <code>FACTOR2_PRM_SAVE</code> will send the current value to <code>PrmDb</code> for storage. <code>PrmDb</code> is an F' infrastructure component that reads and writes parameters to storage. It is important to note that <code>PrmDb</code> does not immediately write the value to storage. There is an explicit <code>PRM_SAVE_FILE</code> command that will take all the parameter values currently in RAM and write them.</p>
<h4><a class="anchor" id="autotoc_md148"></a>
4.1.8.1 Setting the Parameter Value</h4>
<p>The <code>FACTOR1_PRM_SET</code> command can be sent to the software:</p>
<p>The notification function that was implemented as part of the tutorial will send an event indicating the value was updated:</p>
<p>The <code>MS_DO_MATH</code> command can now be executed with the new value:</p>
<p>The <code>MathReceiver</code> component sends the events with the new result:</p>
<p>The new result is <code>1.0</code> with the new value of <code>factor2</code>. The "Channel Telemetry" tab also shows the new values:</p>
<h4><a class="anchor" id="autotoc_md149"></a>
4.1.8.2 Saving the Parameter Value</h4>
<p>Once the parameter value has been tested to the user's satisfaction, it can be saved to <code>PrmDb</code> by sending the <code>FACTOR2_PRM_SAVE</code> command:</p>
<p>The <code>Log Events</code> tab has an event from <code>PrmDb</code> indicating that the <code>FACTOR2</code> parameter value was added:</p>
<h4><a class="anchor" id="autotoc_md150"></a>
4.1.8.3 Writing the Parameter to Storage</h4>
<p>The parameter can be written to storage by sending the <code>PRM_SAVE_FILE</code> command:</p>
<p><code>PrmDb</code> sends an event indicating that the parameters in RAM were stored:</p>
<h3><a class="anchor" id="autotoc_md151"></a>
4.1.9 Ground System Logs</h3>
<p>The ground system keeps logs of all received events and telemetry. They can be found in the directories <code>&lt;deployment&gt;/logs/</code>, where <code>&lt;Run Directory&gt;</code> is the location of the deployment. e.g. <code><a class="el" href="namespace_ref.html">Ref</a></code>.</p>
<h1><a class="anchor" id="autotoc_md152"></a>
Conclusion</h1>
<p>This tutorial is an attempt to communicate the concepts and implementation. If there are aspects that are confusing, feel free to submit GitHub issues asking for clarification or to report errors:</p>
<p><a href="https://github.com/nasa/fprime/issues">https://github.com/nasa/fprime/issues</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
